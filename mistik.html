<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Mistik — TTM 2025</title>
  <link rel="stylesheet" href="./styles.css" />
  <link rel="icon" href="icon.png" type="image/x-icon">
</head>
<body>
  <header class="site-header">
    <nav class="nav" id="site-nav">
      <a class="brand" href="./">AMBALATOR 2.0</a>
      <button class="burger" id="nav-toggle" aria-label="Buka menu" aria-controls="nav-list" aria-expanded="false">
        <span></span>
      </button>
      <ul id="nav-list">
        <li><a href="./">Data</a></li>
        <li><a href="./mistik.html" class="active">Mistik</a></li>
        <li><a href="./silang.html">Silang</a></li>
        <li><a href="./note.html">Note</a></li>
      </ul>
      
    </nav>
  </header>

  <main class="mistik-wrap">
    <section class="card">
      <div class="mistik-header">
        <div>
          <h1>Mistik Macau (Web)</h1>
          <p class="mistik-sub">Masukkan 4 digit & pilih mode. Perhitungan identik dengan rumus di Flutter.</p>
        </div>
      </div>

      <div class="form-grid" style="margin-top:8px">
        <div>
          <label for="angka" class="controls label">Masukkan 4 digit angka terakhir</label>
          <input id="angka" class="input" type="text" inputmode="numeric" maxlength="4" placeholder="cth: 1280" />
        </div>
        <div>
          <label for="mode" class="controls label">Pilih Mode</label>
          <select id="mode" class="select">
            <option value="lama" selected>Mistik Lama</option>
            <option value="baru">Mistik Baru</option>
          </select>
        </div>
        <button id="btnHitung" class="btn" type="button">Rumuskan</button>
        <button id="btnReset" class="btn secondary" type="button">Reset</button>
      </div>

      <small class="hint">Input hanya angka 0–9 (tepat 4 digit).</small>
    </section>

    <section id="hasilWrap" class="card result-card" style="display:none">
      <h2>Hasil Rumus</h2>
      <div class="result-sub">Format: Digit → Indeks → Mistik → Final (final atau final-1)</div>
      <div class="result-table" style="margin-top:8px">
        <table>
          <thead>
            <tr>
              <th class="center">Digit</th>
              <th class="center">Indeks</th>
              <th class="center">Mistik</th>
              <th class="center">Final</th>
            </tr>
          </thead>
          <tbody id="tbodyHasil"></tbody>
        </table>
      </div>
    </section>
  </main>

  <script>
    // Burger toggle
    (function(){
      const nav = document.getElementById('site-nav');
      const btn = document.getElementById('nav-toggle');
      const list = document.getElementById('nav-list');
      if(!nav || !btn || !list) return;
      btn.addEventListener('click', () => {
        const open = nav.classList.toggle('open');
        btn.setAttribute('aria-expanded', open ? 'true':'false');
      });
    })();

    // Logika mistik
    const mistikLama={0:1,1:0,2:5,3:8,4:7,5:2,6:9,7:4,8:3,9:6};
    const mistikBaru={0:8,1:7,2:6,3:9,4:5,5:4,6:2,7:1,8:0,9:3};
    const indeks={1:6,2:7,3:8,4:9,5:0,6:1,7:2,8:3,9:4,0:5};

    const $=(s)=>document.querySelector(s);
    const elAngka=$('#angka'), elMode=$('#mode'), btnHitung=$('#btnHitung'), btnReset=$('#btnReset');
    const wrap=$('#hasilWrap'), tbody=$('#tbodyHasil');

    elAngka.addEventListener('input',()=>{ elAngka.value=elAngka.value.replace(/\D/g,'').slice(0,4); });

    function hitung(){
      const input=elAngka.value;
      if(!/^\d{4}$/.test(input)){ alert('Masukkan 4 digit angka yang benar'); elAngka.focus(); return; }
      const digits=input.split('').map(d=>+d), mode=elMode.value;
      tbody.innerHTML='';
      digits.forEach(d=>{
        const fi=indeks[d];
        const mv=(mode==='lama'?mistikLama[fi]:mistikBaru[fi]);
        const fv=indeks[mv], alt=(fv-1+10)%10;
        const tr=document.createElement('tr');
        [d,fi,mv,`${fv} atau ${alt}`].forEach(v=>{
          const td=document.createElement('td'); td.className='center'; td.textContent=v; tr.appendChild(td);
        });
        tbody.appendChild(tr);
      });
      wrap.style.display='block'; elAngka.blur();
    }

    btnHitung.addEventListener('click',hitung);
    btnReset.addEventListener('click',()=>{ elAngka.value=''; tbody.innerHTML=''; wrap.style.display='none'; elAngka.focus(); });
    elAngka.addEventListener('keydown',e=>{ if(e.key==='Enter'){ e.preventDefault(); hitung(); } });

    // ===== KEY LOCALSTORAGE =====
  const KEY_MISTIK = "amb_mistik_v1";

function saveMistik() {
  const data = {
    angka: elAngka.value,
    mode: elMode.value,
    hasil: tbody.innerHTML,
    visible: wrap.style.display === "block"
  };
  localStorage.setItem(KEY_MISTIK, JSON.stringify(data));
}

function loadMistik() {
  try {
    const raw = localStorage.getItem(KEY_MISTIK);
    if (!raw) return;
    const data = JSON.parse(raw);
    if (data.angka) elAngka.value = data.angka;
    if (data.mode) elMode.value = data.mode;
    if (data.hasil) {
      tbody.innerHTML = data.hasil;
      if (data.visible) wrap.style.display = "block";
    }
  } catch {}
}

// panggil saat hitung
function hitung() {
  const input = elAngka.value;
  if (!/^\d{4}$/.test(input)) {
    alert("Masukkan 4 digit angka yang benar");
    elAngka.focus();
    return;
  }
  const digits = input.split("").map((d) => +d),
    mode = elMode.value;
  tbody.innerHTML = "";
  digits.forEach((d) => {
    const fi = indeks[d];
    const mv = mode === "lama" ? mistikLama[fi] : mistikBaru[fi];
    const fv = indeks[mv],
      alt = (fv - 1 + 10) % 10;
    const tr = document.createElement("tr");
    [d, fi, mv, `${fv} atau ${alt}`].forEach((v) => {
      const td = document.createElement("td");
      td.className = "center";
      td.textContent = v;
      tr.appendChild(td);
    });
    tbody.appendChild(tr);
  });
  wrap.style.display = "block";
  elAngka.blur();
  saveMistik(); // simpan state
}

btnHitung.addEventListener("click", hitung);

btnReset.addEventListener("click", () => {
  elAngka.value = "";
  tbody.innerHTML = "";
  wrap.style.display = "none";
  elAngka.focus();
  localStorage.removeItem(KEY_MISTIK);
});

// simpan saat input berubah
elAngka.addEventListener("input", () => saveMistik());
elMode.addEventListener("change", () => saveMistik());

// init
loadMistik();
  </script>
</body>
</html>
